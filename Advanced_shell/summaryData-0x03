#!/bin/bash

output_file="pokemon_report.csv"
data_dir="pokemon_data"

# Write CSV header
echo "Name,Height (m),Weight (kg)" > "$output_file"

# Temp file for awk processing
tmpfile=$(mktemp)

# Loop over all JSON files
for file in "$data_dir"/*.json; do
  # Extract data using jq
  name=$(jq -r '.name' "$file" | sed 's/.*/\u&/')
  height=$(jq '.height' "$file" | awk '{printf "%.1f", $1 / 10}')
  weight=$(jq '.weight' "$file" | awk '{printf "%.1f", $1 / 10}')
  
  # Write to CSV
  echo "$name,$height,$weight" >> "$output_file"
  
  # Prepare data for averaging
  echo "$height $weight" >> "$tmpfile"
done

echo "CSV Report generated at: $output_file"
echo ""

# Print CSV content
cat "$output_file"
echo ""

# Calculate averages with awk
awk '
{
  sumH += $1;
  sumW += $2;
  count++;
}
END {
  printf "Average Height: %.2f m\n", sumH/count;
  printf "Average Weight: %.2f kg\n", sumW/count;
}
' "$tmpfile"

# Clean up
rm "$tmpfile"

